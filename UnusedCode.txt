# from docx import Document
# from docx.enum.text import WD_ALIGN_PARAGRAPH
# from docx.enum.section import WD_SECTION
# from docx.shared import Pt
# from conteudos import CriaTexto

# document = Document()
# texto = CriaTexto(document)

# # ============================================= Header ===================================================== #

# cabecalho = """Ponto de Presença da Rede Nacional de Ensino e Pesquisa no Rio Grande do Norte - Pop-Rn
# Rede Gigametropole
# Setor de Infraestrutura"""
# texto.criaCabecalho(cabecalho, 1)

# # ============================================= Footer ===================================================== #

# data = '05 de Julho de 2022'
# rodape = "Natal/RN"
# texto.criaRodape(rodape, data)

# # ============================================== Autor e Título ============================================ #

# autor = "\n"*5 + "José Carlos dos Santos" + "\n"*8
# texto.textoSimples(autor, 1, False, False, 12)

# bilhete = "2022.2-BR01"  # deve ser coletado no arquivo .txt
# titulo = "Rede Giga Metrópole\nRelatório de Conformidade Referente ao Bilhete"
# texto.criaTitulo(titulo, bilhete)

# # ===================================== Sumario =============================================== #

# # texto.addNovaSection()

# # document.add_page_break()  # Inserting a new page
# # section1 = document.sections[0]
# # header1 = section1.header
# # header1.is_linked_to_previous = True

# # autor = "\n"*10 + "Aqui será o sumário!!!" + "\n"*12  # Deve ser coletado por meio do arquivo de configuração

# # textoAutor = document.add_paragraph(autor)
# # textoAutor.alignment = 1


# # ===================================== Manutenção Corretiva RGM ============================== #

# texto.addNovaSection()

# listaCelulas = "CA2-ZN-12.1"  # deve ser coletado no arquivo .txt/ou adicionado a um dict.
# objetivo = f"""Objetivo: certificar o serviço de manutenção corretiva realizado pela empresa Interjato Soluções (bilhete {bilhete}) para restabelecer à conectividade GPON na(s) célula(s) {listaCelulas}. Os dados apresentados nesse documento foram obtidos a partir do monitoramento da rede GPON realizado pelo software GRAFANA. """
# textoEntidades = "Entidade(s) afetada(s) pelo rompimento do cabo de fibras óptica:"
# entidades = "EM CMEI EVANGELINA ELITA DE SOUZA"  # deve ser coletado no arquivo .txt
# texto.textoSimples("Manutenção Corretiva RGM", 1, True, False, 12)
# texto.addNewLine()
# texto.textoSimples(objetivo, 3, False, False, 12)
# texto.addNewLine()
# texto.textoSimples(textoEntidades, 3, False, False, 12)
# texto.addNewLine()
# texto.addMarcadores(entidades, 0)  # Dentro do método, use um for para mais escolas
# texto.addNewLine()
# textoLocalOcorrencia = "Local da Ocorrência:"  # Use um for para imprimir os locais, incluíndo os marcadores.
# texto.textoSimples(textoLocalOcorrencia, 3, False, False, 12)
# texto.addNewLine()
# texto
# # texto.textoSimples('Grupo ', 3, False, False, 12)  # Use um for para imprimir os locais, incluíndo os marcadores.
# # texto.textoSimples(f'{listaCelulas}:', 3, True, False, 12)
# texto.addNewLine()



# # https://python-docx.readthedocs.io/en/latest/user/quickstart.html


# document.save(f"REPORT_{bilhete}.docx")



def criaCabecalho (self, textoCabecalho, alinhamento):  # não foi usado.
        
        section = self.document.sections[0]
        header = section.header
        # header = section.first_page_header  # não foi usado.

        cabecalho = header.paragraphs[0]
        cabecalho.text = textoCabecalho  # Para textos com quebra de linha usar """ """.
        cabecalho.alignment = alinhamento  # Siga a docstring do método textoSimples()
        cabecalho_styles = self.document.styles["Header"]
        cabecalho_styles.font.name = 'Arial'
        cabecalho_styles.font.size = Pt(12)
        
    def criaTitulo (self, textoTitulo, anexo):  # não foi usado.

        titulo = self.document.add_paragraph()
        titulo.paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER
        titulo.paragraph_format.line_spacing = 1.50
        texto = f"""{textoTitulo} {anexo}"""
        r = titulo.add_run(texto)
        r.font.name = 'Arial'
        r.font.size = Pt(12)
        r.bold = True
    
    def criaRodape (self, textoRodape, data):  # não foi usado.

        section = self.document.sections[0]
        footer = section.footer
        # footer = section.first_page_footer  # não foi usado.

        footer_p = footer.paragraphs[0]
        footer_p.text = f"{textoRodape}\n{data}"
        footer_p.alignment = 1
        footer_p_styles = self.document.styles["Footer"]
        footer_p_styles.font.name = 'Arial'
        footer_p_styles.font.size = Pt(12)

    
    def addNovaSection(self):  # não foi usado.
        newSection = self.document.add_section(WD_SECTION.NEW_PAGE)
        newSection.different_first_page_header_footer = True




TESTE DE ENTRADA DE DADOS

celula = 'CAIXA1'
entidade = 'ENTIDADE 2'
endereco = 'ENDERECO 2'
potMedia = 0
potBefore = 0
potAfter = 0

dadosDict = preencheDict.fillDict(dadosDict, celula, entidade, endereco, potMedia, potBefore, potAfter)
# print(dadosDict)

celula = 'CAIXA2'
entidade = 'ENTIDADE 1'
endereco = 'ENDERECO 1'
potMedia = 0
potBefore = 0
potAfter = 0

dadosDict = preencheDict.fillDict(dadosDict, celula, entidade, endereco, potMedia, potBefore, potAfter)
# print(dadosDict)

celula = 'CAIXA2'
entidade = 'ENTIDADE 2'
endereco = 'ENDERECO 2'
potMedia = 0
potBefore = 0
potAfter = 0

dadosDict = preencheDict.fillDict(dadosDict, celula, entidade, endereco, potMedia, potBefore, potAfter)
print(dadosDict)


    def imprimeMarcadorEndereco(self, dado, p, fonte, negrito, italico, tam):
        
        i=0
        # p.paragraph_format.left_indent = Inches(0.5)
        # f.left_indent = Inches(0.5)
        # p.style = 'List Bullet'

        for entidadeSuiperior in dado.keys():  # Lembre-se de criar um método para tratar os loops
            for entidadeInferior in dado[entidadeSuiperior].keys():
                # t = p.add_run(f'Endereço {i+1}: ')
                # s = p.add_run(f'{dado[entidadeSuiperior][entidadeInferior][0]}; \n')
                # estilos.addStyles(t, fonte, negrito1, italico, tam)
                # estilos.addStyles(s, fonte, negrito2, italico, tam)
                # CriaTexto(self.document).textoFormat(p, 0, 1.50, 0, 0)
                # p.style = 'List Bullet'
                CriaTexto(self.document).addMarcadores(f'Endereço {i+1}: {dado[entidadeSuiperior][entidadeInferior][0]}', fonte, 0, negrito, italico, tam)
                i += 1



# preencheDict.celula = 'CELULA 1'
# preencheDict.entidade = 'ENTIDADE 1 DA CELULA 1'
# preencheDict.endereco = 'Rua, Numero, Bairro, Cidade/Estado'
# preencheDict.potMedia = -16
# preencheDict.potBefore = -16
# preencheDict.potAfter = -17

# preencheDict.dadosDict = dadosDict

# preencheDict.fillDict()  # dever ser chamada desta forma no botão da interface

# celula = 'CELULA 1'
# entidade = 'ENTIDADE 2 DA CELULA 1'
# endereco = 'Rua, Numero, Bairro, Cidade/Estado'
# potMedia = -11
# potBefore = -15.80
# potAfter = -12.79

# dadosDict = preencheDict.fillDict(dadosDict, celula, entidade, endereco, potMedia, potBefore, potAfter)

# celula = 'CELULA 2'
# entidade = 'ENTIDADE 1 DA CELULA 2'
# endereco = 'Rua, Numero, Bairro, Cidade/Estado'
# potMedia = -10
# potBefore = -12.85
# potAfter = -15.64

# dadosDict = preencheDict.fillDict(dadosDict, celula, entidade, endereco, potMedia, potBefore, potAfter)

# print('Linha 62:', dadosDict)


CÓDIGO DO GERADOR DE DOCX______________________________________________________________________________________________

texto = CriaTexto(document)
estilos = StylesText(document)
preencheDict = WriteDict()
pageConfig = SetupPage(document)
analise = AnalysisFunc(document)


global dadosDict, bilheteEnt, causaCorrecao, rangeTeste, observations

bilheteEnt = '20XX.X-BRXX'
causaCorrecao =  'O rompimento nas fibras foi causado por acidente por árvores.'
rangeTeste = 30
observations = ""
dadosDict = dict()

# ============================================= Teste ======================================================== #

preencheDict.celula = 'CELULA 1'
preencheDict.entidade = 'ENTIDADE 1 DA CELULA 1'
preencheDict.endereco = 'Rua, Numero, Bairro, Cidade/Estado'
preencheDict.potMedia = -16
preencheDict.potBefore = -16
preencheDict.potAfter = -17

preencheDict.dadosDict = dadosDict

preencheDict.fillDict()  # dever ser chamada desta forma no botão da interface


# ============================================== Margins ===================================================== #

pageConfig.marginsPage(3.0, 3.0, 2.0, 2.0)

# ================================================ Capa ====================================================== #

tecnicoEnt = '*Nome do Técnico*'
matTecnico = '****'
bolsistaEnt = '*Nome do bolsista*'
matbolsista = '*Matrícula do bolsista*'
dataEnt = 'XX de mês de 20XX'

texto.textoSimples(tecnicoEnt, 'Arial', 1, False, False, 12, False)
texto.textoSimples(f'Matrícula: {matTecnico}', 'Arial', 1, False, False, 12, False)
texto.textoSimples(f'Bolsista: {bolsistaEnt}', 'Arial', 1, False, False, 12, False)
texto.textoSimples(f'Matrícula: {matbolsista}', 'Arial', 1, False, False, 12, False)
texto.addNewLine(6)

titulo = f'Rede Giga Metrópole\nRelatório de Conformidade Referente ao Bilhete {bilheteEnt}'
texto.textoSimples(titulo, 'Arial', 1, True, False, 12, False)
texto.addNewLine(6)

cabecalho = """Ponto de Presença da Rede Nacional de Ensino e Pesquisa no Rio Grande do Norte - POP-RN
Rede GigaMetropole
Setor de Infraestrutura"""
texto.textoSimples(cabecalho, 'Arial', 1, False, False, 12, False)
texto.addNewLine(5)

texto.textoSimples('Natal - RN', 'Arial', 1, False, False, 12, False)
texto.textoSimples(dataEnt, 'Arial', 1, False, False, 12, False)

# ============================================== Sumário ===================================================== #

texto.textoSimples('INSIRA O SUMÁRIO AQUI', 'Arial', 1, False, False, 40, False)

# ================================================ Page Number =============================================== #

section = document.sections[0]
footer = section.footer
texto.addNovaSection()
pageConfig.add_page_number(footer.paragraphs[0])

# ===================================== Manutenção Corretiva RGM ============================================= #
document.add_page_break()

texto.textoSimples ('Manutenção Corretiva RGM', 'Arial', 1, True, False, 12, False)
texto.addNewLine(0)

p = document.add_paragraph()

t1 = p.add_run('Objetivo: certificar o serviço de manutenção corretiva realizado pela empresa Interjato Soluções (')
estilos.addStyles(t1, 'Arial', False, False, 12)
estilos.addStyles(p.add_run(f'bilhete {bilheteEnt}'), 'Arial', True, False, 12)

t3 = p.add_run(') para restabelecer à conectividade GPON na(s) célula(s) ')
estilos.addStyles(t3, 'Arial', False, False, 12)
texto.repeteListaEmUmaLinha(list(dadosDict.keys()), p, 'Arial', True, False, 12)

t5 = p.add_run('. Os dados apresentados nesse documento foram obtidos a partir do monitoramento da rede GPON realizado pelo software ')
estilos.addStyles(t5, 'Arial', False, False, 12)
estilos.addStyles(p.add_run('Grafana.'), 'Arial', True, True, 12)
texto.addNewLine(0)

texto.textoSimples ('Entidade(s) afetada(s) pelo rompimento do cabo de fibras óptica:', 'Arial', 3, False, False, 12, False)
texto.addNewLine(0)

texto.repetMarcadoreEntidade(dadosDict, 'Arial', 0, negrito=True, italico=False, tam=12)
texto.addNewLine(0)

texto.textoSimples('Local da Ocorrência:', 'Arial', 3, False, False, 12, False)
texto.addNewLine(0)

texto.imprimeMarcadorEndereco(dadosDict, 'Arial', negrito=False, italico=False, tam=12)

q = document.add_paragraph()  # necessário pois, ao usar o método .textoSimples(), um novo .add_paragraph() é iniciado.
pf = q.paragraph_format
pf.left_indent = Inches(0.5)
q.style = 'List Bullet'
texto.repeteListaEmUmaLinha('Trecho(s): ', q, fonte='Arial', negrito=False, italico=False, tam=12)

texto.imprimeCaixaEntidade(dadosDict, q, fonte='Arial', negrito=True, italico=False, tam=12)
texto.addNewLine(0)

texto.textoSimples('Informações do Cabo:', 'Arial', 3, False, False, 12, False)
texto.addNewLine(0)
texto.addMarcadores(causaCorrecao, 'Arial', 0, False, False, 12)

texto.textoFormat(p, 3, 1.50, 0, 0)
texto.textoFormat(q, 0, 1.50, 0, 0)

# ============================================== Seção 1 ===================================================== #

document.add_page_break()

texto1 = """Todos os ativos GPON da Rede Gigametrópole são monitorados pelo software GRAFANA. Dentre os parâmetros monitorados, são de interesse nesse processo de certificação os valores de potência óptica recebidos que são enviados periodicamente pelas ONU(s). A certificação é baseadas nos seguintes requisitos:"""

texto.textoSimples('1   Certificação', 'Arial', 3, True, False, 12, False)
texto.addNewLine(0)
texto.textoSimples('1.1 Metodologia', 'Arial', 3, True, False, 12, False)
texto.addNewLine(0)

texto.textoSimples(texto1, 'Arial', 3, False, False, 12, True)
texto.addNewLine(0)

requisitos = ['Comparação entre os valores de potência recebidos antes e depois do incidente;',
'Comparação entre os valores de potência recebido em cada cliente (ONU) afetado pelo incidente e a média de potência recebida nos outros clientes da mesma célula;',
'Análise do comportamento do sinal recebido na(s) ONU(s), buscando identificar oscilações relevantes (maiores que 1 dB entorno do valor médio) na magnitude do sinal.']

texto.repetMarcadores(requisitos, 'Arial', 3, False, False, 12)
texto.addNewLine(0)

texto.textoSimples('1.2 Diagnóstico', 'Arial', 3, True, False, 12, False)
texto.addNewLine(0)
texto2 = """A comparação dos resultados obtidos pelo monitoramento apresentados no(s) gráfico(s) da(s) figura(s) apresentada(s) no Resultados e nos dados da tabela 3, mostram que os níveis de potência óptica recebidos na(s) ONU(s) são coerentes. São sintetizados nas tabelas 1 e 2, as respostas aos requisitos estabelecidos e o diagnóstico da manutenção corretiva. """
texto.textoSimples(texto2, 'Arial', 3, False, False, 12, True)
texto.addNewLine(0)

# ============================================== Requisitos de teste ========================================= #

r1 = 'R1 – Os valores de potência permaneceram na mesma ordem de grandeza antes e depois do incidente?'
texto.addMarcadores(r1, 'Arial', 3, False, False, 12)

pj = document.add_paragraph()
pk = pj.paragraph_format
pk.left_indent = Inches(0.5)
r = pj.add_run('R2 – Considerando que o valor médio de potência óptica recebida nas ONU(s) das escolas, nas células ')
pj.style = 'List Bullet'
estilos.addStyles(r, 'Arial', False, False, 12)
texto.textoFormat(pj, 3, 1.50, 0, 0)

texto.repeteListaEmUmaLinha(list(dadosDict.keys()), pj, 'Arial', True, False, 12)

r2b = ' é de '
texto.repeteListaEmUmaLinha(r2b, pj, 'Arial', False, False, 12)

for caixa in dadosDict.keys():  # Lembre-se de criar um método para tratar os loops
    for escola in dadosDict[caixa].keys():
        texto.repeteListaEmUmaLinha(str(dadosDict[caixa][escola][1]) + ' dBm, ', pj, 'Arial', False, False, 12)

r2c = ' a potência obtida na(s) ONU(s) após o reparo estão na mesma ordem de grandeza do valor médio?'
texto.repeteListaEmUmaLinha(r2c, pj, 'Arial', False, False, 12)

r3 = 'R3 – A oscilação no sinal recebido é aceitável?'
texto.addMarcadores(r3, 'Arial', 3, False, False, 12)

# ============================================== Seção 2 ===================================================== #

texto.textoSimples('Legendas das respostas aos requisitos:', 'Arial', 3, False, False, 12, False)
texto.addNewLine(0)
texto.textoSimples('1.  OK – Em conformidade;', 'Arial', 3, False, False, 12, True)
texto.textoSimples('2.  X – Não atende ao requisito.', 'Arial', 3, False, False, 12, True)
texto.addNewLine(0)

# Tabela 1: __________________________________________________________________________

texto.textoSimples('Tabela 1 – Resultado do diagnóstico', 'Arial', 1, False, False, 12, False)

table = document.add_table(rows=1, cols=4)
row = table.rows[0].cells
headerRow = ['ESCOLA', 'R1', 'R2', 'R3']
texto.alimentaTabela(row, headerRow, 'Arial', 12)

dataDiagnostic = list()
dataDiagnosticStatus = list()
dataDiagnosticPot = list()
for enS in dadosDict.keys():
    for enI in dadosDict[enS].keys():
        a1 = analise.rR1(dadosDict[enS][enI][2], dadosDict[enS][enI][3])
        a2 = analise.rR2(dadosDict[enS][enI][1], dadosDict[enS][enI][3])
        a3 = analise.rR3(dadosDict[enS][enI][3])
        status = analise.rStatus(a1, a2, a3)
        dataDiagnostic.append([enI, a1, a2, a3])
        dataDiagnosticStatus.append([enI, status])
        dataDiagnosticPot.append([enI, str(dadosDict[enS][enI][2]), str(dadosDict[enS][enI][3])])

print(dataDiagnostic)
print(dataDiagnosticStatus)
print(dataDiagnosticPot)


for escola, r1, r2, r3 in dataDiagnostic:  # Adding a row and then adding data in it.
    row = table.add_row().cells
    listaLinhas = [escola, r1, r2, r3]
    texto.alimentaTabela(row, listaLinhas, 'Arial', 12)

for cell1 in table.columns[0].cells:
    cell1.width = Inches(2.8)

for i in range(1, 4):
    for cell in table.columns[i].cells:
        cell.width = Inches(0.5)

table.style = 'Table Grid'
table.alignment = WD_TABLE_ALIGNMENT.CENTER
texto.addNewLine(0)

# Tabela 2: __________________________________________________________________________

texto.textoSimples('1.3 Status', 'Arial', 3, True, False, 12, False)
texto.addNewLine(0)
texto.textoSimples('O serviço de manutenção corretiva é qualificado conforme os status apresentados na tabela 2.', 'Arial', 3, False, False, 12, True)
texto.addNewLine(0)

texto.textoSimples('Tabela 2 – Status do serviço de manutenção corretiva', 'Arial', 1, False, False, 12, False)

table2 = document.add_table(rows=1, cols=2)
row2 = table2.rows[0].cells
headerRow2 = ['PONTO ATENDIDO', 'STATUS']
texto.alimentaTabela(row2, headerRow2, 'Arial', 12)

for escola, status in dataDiagnosticStatus:  # Adding a row and then adding data in it.
    row2 = table2.add_row().cells
    listaLinhas2 = [escola, status]
    texto.alimentaTabela(row2, listaLinhas2, 'Arial', 12)

for cell2 in table2.columns[0].cells:
    cell2.width = Inches(2.8)

for i in range(1, 2):
    for cell in table2.columns[i].cells:
        cell.width = Inches(1.5)

table2.style = 'Table Grid'
table2.alignment = WD_TABLE_ALIGNMENT.CENTER
texto.addNewLine(0)

texto.textoSimples('2   Resultados', 'Arial', 3, True, False, 12, False)
texto.addNewLine(0)

# Tabela 3: __________________________________________________________________________

texto.textoSimples('Tabela 3 – Valor médio da potência óptica recebida nas ONUs', 'Arial', 1, False, False, 12, False)

table3 = document.add_table(rows=1, cols=3)
row3 = table3.rows[0].cells
headerRow3 = ['ESCOLA', 'PRxA[dBm]', 'PRxB[dBm]']
texto.alimentaTabela(row3, headerRow3, 'Arial', 12)

dataStatus = []  # Table data in a form of list
for i in range(0,3):  # o range do for pode variar em função da quantidade de entidades
    dataStatus.append([f'Entidade {i+1}', str(-17.65), str(-12.65)])

for escola, ptA, ptD in dataDiagnosticPot:  # Adding a row and then adding data in it.
    row3 = table3.add_row().cells
    listaLinhas3 = [escola, ptA, ptD]
    texto.alimentaTabela(row3, listaLinhas3, 'Arial', 12)

for cell3 in table3.columns[0].cells:
    cell3.width = Inches(2.8)

for i in range(1, 3):
    for cell in table3.columns[i].cells:
        cell.width = Inches(1.0)

table3.style = 'Table Grid'
table3.alignment = WD_TABLE_ALIGNMENT.CENTER
texto.addNewLine(0)

texto.addMarcadores ('PRxA [dBm] - Potência óptica recebida na ONU antes do incidente;', 'Arial', 3, False, False, 12)
texto.addMarcadores ('PRxB [dBm] - Potência óptica recebida na ONU após o reparo.', 'Arial', 3, False, False, 12)


# ============================================== Seção 3 ===================================================== #
document.add_page_break()

texto3 = f'No(s) gráfico(s) apresentado(s) na(s) figura(s) a seguir, os resultados mostram o comportamento do sinal recebido durante o período de {rangeTeste} dias, considerando antes e após o serviço de reparação ser executado. É importante ressaltar que no decorrer do período de amostragem apresentado no(s) gráfico(s) podem ocorrer intervalos sem amostras, como o período de observação é grande e os dados são enviados pelas ONU, é possível que em algum momento o equipamento seja desligado.'
texto.textoSimples(texto3, 'Arial', 3, False, False, 12, True)
texto.addNewLine(0)

for i in range(0, len(dataDiagnosticStatus)):
    texto.textoSimples(f'Figura {i+1} - Monitoramento GPON: potência óptica recebida na ONU da {dataDiagnosticStatus[i][0]}', 'Arial', 1, False, False, 12, False)
    document.add_picture(f'img/0{str(i+1)}.JPG')
    texto.addNewLine(0)

# ============================================== Seção 4 ===================================================== #

document.add_page_break()

texto.textoSimples('3   Conclusão', 'Arial', 3, True, False, 12, False)
texto.addNewLine(0)
texto4 = 'Conclui-se que os resultados apresentados nesse documento certificam que o serviço de manutenção corretiva foi executado em conformidade com os padrões exigidos e sanando todas as pendências, garantindo o correto funcionamento da rede.'
texto.textoSimples(texto4, 'Arial', 3, False, False, 12, True)

# teste se a função abaixo funciona dentro de uma outra função sendo chamada no arquivo da interface
document.save(f"REPORT_{bilheteEnt}.docx")



# OBS: seu arquivo do texto docx terá duas funções: uma que irá conter todo o conteúdo que produz o texto e que retorna o dadosDict e 
# uma outra função, retornando o dado 'document.save(f"REPORT_{bilheteEnt}.docx")'


# lembre-se dessa classe abaixo para criar as funções acima. Lembre-se também de instanciar as classes dentro da primeira função.



"""
class Imprime:
    def __init__(self, dado=''):
        self.dado = dado
        pass
    
    def imprime(self):
        return self.dado

def teste(dado):
    var1 = Imprime()
    var1.dado = dado
    return var1.imprime()

print(teste('Carlos'))

"""





    # motivo.delete(0, END)
    # tecnico.delete(0, END)
    # matricula_tecnico.delete(0, END)
    # bolsista.delete(0, END)
    # matricula_bolsista.delete(0, END)
        
    # bilhete.delete(0, END)
    # celula.delete(0, END)
    # data.delete(0, END)